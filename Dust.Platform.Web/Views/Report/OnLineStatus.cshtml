
@{
    Layout = null;
}

<div class="panel panel-info">
    <div class="panel-body">
        <div class="form-horizontal">
            <span for="onlineDateType">在线率统计时间类型：</span>
            <select id="onlineDateType" style="width: 120px;">
                <option value="3">月在线率统计</option>
                <option value="6">年在线率统计</option>
            </select>
            <span for="onlineObjectType">在线率统计对象类型：</span>
            <select id="onlineObjectType" style="width: 160px;">
                <option value="3">区县在线率统计</option>
                <option value="2">企业在线率统计</option>
                <option value="1">工程在线率统计</option>
                <option value="0">设备在线率统计</option>
            </select>
            <span for="onlineDateTime">在线率统计时间：</span>
            <select id="onlineDateTime" style="width: 160px;"></select>
        </div>
        <div class="form-horizontal" style="margin-top: 10px;">
            <span for="objectFilter">筛选查询对象：</span>
            <select id="objectFilter" style="width: 270px;" multiple="multiple"></select>
            <input type="button" class="btn btn-primary" value="查看" style="margin-right: 5px;" id="viewOnlineStatistics" />
            <input type="button" class="btn btn-primary" value="导出" />
        </div>
        <div style="margin-top: 15px;">
            @{ var table = Html.BootstrapTable(null, TablePaginationOption.server, new
                {
                    id = "onlineStatisticsRank",
                    data_url = "/Report/OnlineStatisticsRankTable",
                    data_page_size = 50,
                    data_height = 550
                });
                var builder = table.Column("对象名称", "TargetName")
                    .Column("在线率", "OnlineRank")
                    .Column("统计时间", "DateTime");
            }
            @(builder)
        </div>
    </div>
</div>

<script type="text/javascript">
    $('select').select2();
    var onlineDateTime = $('#onlineDateTime').select2({
        placeholder: {
            id: '-1',
            text: '选择一个时间。'
        },
        ajax: {
            url: '/Report/OnlineStatisticsDates',
            data: function () {
                var query = {
                    DateType: $('#onlineDateType').val(),
                    ObjectType: $('#onlineObjectType').val()
                };
                return query;
            },
            cache: true,
            processResults: function (data) {
                return {
                    results: data.ret
                }
            }
        }
    });
    var objectFilter = $('#objectFilter').select2({
        placeholder: {
            id: '-1',
            text: '选择想要查询的对象，空选表示全查询。'
        },
        ajax: {
            url: '/Report/OnlineStatisticsTargets',
            data: function () {
                var query = {
                    ObjectType: $('#onlineObjectType').val()
                };
                return query;
            },
            cache: true,
            processResults: function (data) {
                return {
                    results: data
                }
            }
        }
    });
    $('#onlineDateTime').on('opening', function () {
        $('#onlineDateTime').empty();
    });
    $('#objectFilter').on('opening', function () {
        $('#objectFilter').empty();
    });
    $('#viewOnlineStatistics').on('click', function () {
        $('#onlineStatisticsRank').bootstrapTable('refresh');
    });

    $('#onlineDateType').on('select2:select', function () {
        objectFilter.val(null).trigger('change');
        onlineDateTime.val(null).trigger('change');
    });

    $('#onlineObjectType').on('select2:select', function () {
        objectFilter.val(null).trigger('change');
        onlineDateTime.val(null).trigger('change');
    });

    $('#onlineStatisticsRank').bootstrapTable({
        queryParams: function (params) {
            debugger;
            params.StatusType = $('#onlineDateType').val();
            params.Category = $('#onlineObjectType').val();
            params.DateTimeTicks = $('#onlineDateTime').val();
            params.TargetObjects = $('#objectFilter').val();
            return params;
        }
    });
</script>
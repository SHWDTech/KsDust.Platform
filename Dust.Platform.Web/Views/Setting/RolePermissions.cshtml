@model Dust.Platform.Web.Models.Account.RolePermissionsModel
@{
    Layout = null;
}

<div id="RolePermissions">
    @using (Ajax.BeginForm("RolePermissions", "Setting", null, new AjaxOptions
    {
        HttpMethod = "POST",
        UpdateTargetId = "RolePermissions"
    }, new { @class = "form-group" }))
    {
        <div class="panel panel-default">
            <div class="panel panel-heading">
                <input type="hidden" name="RoleId" id="RoleId" value="@Model.RoleId" />
                <h3>
                    设置【<label class="text-main">@Model.RoleName</label>】权限
                </h3>
            </div>
            <ul class="list-group" style="margin-bottom: 0;">
                @{
                    foreach (var permission in Model.Permissions.Where(obj => obj.ParentPermissionId == null))
                    {
                        <li class="list-group-item">
                            <div>
                                <h4>
                                    @{
                                        var enabled = Model.RolePermissions.Any(obj => obj.Id == permission.Id);
                                        var chked = enabled ? "checked" : "";
                                    }
                                    <input type="checkbox" name="RolePermissions" class="parent-permission" id="@permission.Id" value="@permission.Id" @chked />
                                    <label for="@permission.Id" class="lbl120 text-main-reverse font-20">@permission.PermissionDisplayName</label>
                                </h4>
                                @{
                                    foreach (var subPermission in Model.Permissions.Where(item => item.ParentPermissionId != null && item.ParentPermissionId.Value == permission.Id))
                                    {
                                        var subchked = Model.RolePermissions.Any(obj => obj.Id == subPermission.Id) ? "checked" : "";
                                        var subEnabled = enabled ? "" : "disabled";
                                        <input type="checkbox" name="RolePermissions" class="child-permission" id="@subPermission.Id" value="@subPermission.Id" data-parent="@permission.Id" @subchked @subEnabled />
                                        <label for="@subPermission.Id" class="lbl120">@subPermission.PermissionDisplayName</label>
                                    }
                                }
                            </div>

                        </li>
                                    }
                }
            </ul>
            <div>
                @Html.ValidationSummary()
            </div>
            <div class="panel panel-body text-right">
                <input type="submit" value="确认修改" class="btn btn-success" />
            </div>
        </div>
                                    }
</div>

<script type="text/javascript">
    $(function () {
        $('.parent-permission').on('click', function () {
            var value = $(this).val();
            $('.child-permission[data-parent=' + value + ']').prop('checked', $(this).prop('checked')).prop('disabled', !$(this).prop('checked'));
        });
    })
</script>